// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                               String                         @id @default(cuid())
  name                             String
  email                            String                         @unique
  password                         String
  role                             UserRole
  unit                             String?
  createdAt                        DateTime                       @default(now())
  updatedAt                        DateTime                       @updatedAt
  IndicatorSubmission              IndicatorSubmission[]
  Risk                             Risk[]
}

model IndicatorSubmission {
  id                String             @id @default(cuid())
  name              String
  category          IndicatorCategory
  description       String             @db.Text
  unit              String
  frequency         IndicatorFrequency
  status            IndicatorStatus    @default(Menunggu_Persetujuan)
  submissionDate    DateTime           @default(now())
  standard          Float
  standardUnit      StandardUnit
  rejectionReason   String?            @db.Text
  submittedById     String
  submittedBy       User               @relation(fields: [submittedById], references: [id])
  Indicator         Indicator[]
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  @@index([submittedById])
}

model Indicator {
  id              String             @id @default(cuid())
  submissionId    String
  submission      IndicatorSubmission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  period          DateTime
  numerator       Float
  denominator     Float
  analysisNotes   String?            @db.Text
  followUpPlan    String?            @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  @@index([submissionId])
}

model Incident {
  id                    String          @id @default(cuid())
  date                  DateTime        @default(now())
  status                IncidentStatus  @default(Investigasi)
  patientName           String?
  medicalRecordNumber   String?
  careRoom              String?
  ageGroup              String?
  gender                String?
  payer                 String?
  entryDate             DateTime?
  entryTime             String?
  incidentDate          DateTime?
  incidentTime          String?
  chronology            String?         @db.Text
  type                  IncidentType
  incidentSubject       String?
  incidentLocation      String?
  relatedUnit           String?
  firstAction           String?         @db.Text
  firstActionBy         String?
  hasHappenedBefore     String?
  severity              SeverityLevel
  patientImpact         String?
  analysisNotes         String?         @db.Text
  followUpPlan          String?         @db.Text
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt
}

model Risk {
  id                    String          @id @default(cuid())
  unit                  String
  source                RiskSource
  description           String          @db.Text
  cause                 String          @db.Text
  category              RiskCategory
  submissionDate        DateTime        @default(now())
  consequence           Int
  likelihood            Int
  controllability       Int
  evaluation            RiskEvaluation
  actionPlan            String          @db.Text
  dueDate               DateTime?
  picId                 String?
  pic                   User?           @relation(fields: [picId], references: [id])
  status                RiskStatus      @default(Open)
  residualConsequence   Int?
  residualLikelihood    Int?
  reportNotes           String?         @db.Text
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt

  @@index([picId])
}

enum UserRole {
  ADMIN_SISTEM
  PIC_MUTU
  PJ_RUANGAN
  KEPALA_UNIT_INSTALASI
  DIREKTUR
  SUB_KOMITE_PENINGKATAN_MUTU
  SUB_KOMITE_KESELAMATAN_PASIEN
  SUB_KOMITE_MANAJEMEN_RISIKO
}

enum IndicatorCategory {
  INM
  IMP_RS
  IMPU
  SPM
}

enum IndicatorFrequency {
  Harian
  Mingguan
  Bulanan
  Tahunan
}

enum StandardUnit {
  persen
  menit
}

enum IndicatorStatus {
  Menunggu_Persetujuan
  Diverifikasi
  Ditolak
}

enum IncidentStatus {
  Investigasi
  Selesai
}

enum IncidentType {
  KPC
  KNC
  KTC
  KTD
  Sentinel
}

enum SeverityLevel {
  biru
  hijau
  kuning
  merah
}

enum RiskSource {
  Laporan_Insiden
  Komplain
  Survey_Ronde
  Rapat_Brainstorming
  Investigasi
  Litigasi
  External_Requirement
}

enum RiskCategory {
  Strategis
  Operasional
  Finansial
  Compliance
  Reputasi
  Pelayanan_Pasien
  Bahaya_Fisik
  Bahaya_Kimia
  Bahaya_Biologi
  Bahaya_Ergonomi
  Bahaya_Psikososial
}

enum RiskEvaluation {
  Mitigasi
  Transfer
  Diterima
  Dihindari
}

enum RiskStatus {
  Open
  In_Progress
  Closed
}
