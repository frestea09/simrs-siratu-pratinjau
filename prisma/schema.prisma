// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ==================================
//          ENUMS
// ==================================

enum UserRole {
  ADMIN_SISTEM
  PIC_MUTU
  PJ_RUANGAN
  KEPALA_UNIT_INSTALASI
  DIREKTUR
  SUB_KOMITE_PENINGKATAN_MUTU
  SUB_KOMITE_KESELAMATAN_PASIEN
  SUB_KOMITE_MANAJEMEN_RISIKO
}

enum IndicatorCategory {
  INM
  IMP_RS
  IMPU
  SPM
}

enum IndicatorFrequency {
  HARIAN
  MINGGUAN
  BULANAN
  TAHUNAN
}

enum SubmissionStatus {
  MENUNGGU_PERSETUJUAN
  DIVERIFIKASI
  DITOLAK
}

enum StandardUnit {
  PERSEN
  MENIT
}

enum IndicatorStatus {
  MEMENUHI_STANDAR
  TIDAK_MEMENUHI_STANDAR
  NA
}

enum IncidentType {
  KPC
  KNC
  KTC
  KTD
  SENTINEL
}

enum IncidentSeverity {
  BIRU
  HIJAU
  KUNING
  MERAH
}

enum IncidentStatus {
  INVESTIGASI
  SELESAI
}

enum RiskSource {
  LAPORAN_INSIDEN
  KOMPLAIN
  SURVEY_RONDE
  RAPAT_BRAINSTORMING
  INVESTIGASI
  LITIGASI
  EXTERNAL_REQUIREMENT
}

enum RiskCategory {
  STRATEGIS
  OPERASIONAL
  FINANSIAL
  COMPLIANCE
  REPUTASI
  PELAYANAN_PASIEN
  BAHAYA_FISIK
  BAHAYA_KIMIA
  BAHAYA_BIOLOGI
  BAHAYA_ERGONOMI
  BAHAYA_PSIKOSOSIAL
}

enum RiskLevel {
  Rendah
  Moderat
  Tinggi
  Ekstrem
}

enum RiskEvaluation {
  MITIGASI
  TRANSFER
  DITERIMA
  DIHINDARI
}

enum RiskStatus {
  OPEN
  IN_PROGRESS
  CLOSED
}

// ==================================
//          MODELS
// ==================================

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole
  unit      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  risks Risk[]
}

model IndicatorSubmission {
  id              String             @id @default(cuid())
  name            String
  category        IndicatorCategory
  description     String             @db.Text
  unit            String
  frequency       IndicatorFrequency
  status          SubmissionStatus
  submissionDate  DateTime           @default(now())
  standard        Float
  standardUnit    StandardUnit
  rejectionReason String?            @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
}

model Indicator {
  id            String             @id @default(cuid())
  indicator     String
  category      IndicatorCategory
  unit          String
  period        DateTime
  frequency     IndicatorFrequency
  numerator     Float
  denominator   Float
  standard      Float
  standardUnit  StandardUnit
  analysisNotes String?            @db.Text
  followUpPlan  String?            @db.Text
  ratio         String
  status        IndicatorStatus
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
}

model Incident {
  id                  String           @id @default(cuid())
  date                DateTime         @default(now())
  status              IncidentStatus
  patientName         String?
  medicalRecordNumber String?
  careRoom            String?
  ageGroup            String?
  gender              String?
  payer               String?
  entryDate           DateTime?
  entryTime           String?
  incidentDate        DateTime?
  incidentTime        String?
  chronology          String?          @db.Text
  type                IncidentType
  incidentSubject     String?
  incidentLocation    String?
  relatedUnit         String?
  firstAction         String?          @db.Text
  firstActionBy       String?
  hasHappenedBefore   String?
  severity            IncidentSeverity
  patientImpact       String?
  analysisNotes       String?          @db.Text
  followUpPlan        String?          @db.Text
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
}

model Risk {
  id                  String         @id @default(cuid())
  unit                String
  source              RiskSource
  description         String         @db.Text
  cause               String         @db.Text
  category            RiskCategory
  submissionDate      DateTime       @default(now())
  consequence         Int
  likelihood          Int
  cxl                 Int
  riskLevel           RiskLevel
  controllability     Int
  riskScore           Int
  evaluation          RiskEvaluation
  actionPlan          String         @db.Text
  dueDate             DateTime?
  picId               String?
  status              RiskStatus
  residualConsequence Int?
  residualLikelihood  Int?
  residualRiskScore   Int?
  residualRiskLevel   RiskLevel?
  reportNotes         String?        @db.Text
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt

  pic User? @relation(fields: [picId], references: [id])
}
